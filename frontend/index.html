<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SME Reconciliation MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(214.3 31.8% 91.4%)",
                        input: "hsl(214.3 31.8% 91.4%)",
                        ring: "hsl(222.2 84% 4.9%)",
                        background: "hsl(0 0% 100%)",
                        foreground: "hsl(222.2 84% 4.9%)",
                        primary: {
                            DEFAULT: "hsl(222.2 47.4% 11.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        secondary: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        destructive: {
                            DEFAULT: "hsl(0 84.2% 60.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        muted: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(215.4 16.3% 46.9%)",
                        },
                        accent: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        card: {
                            DEFAULT: "hsl(0 0% 100%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --radius: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50">
    <!-- Header -->
    <header class="border-b bg-white">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center space-x-3">
                <div class="p-2 bg-blue-600 rounded-lg">
                    <i data-lucide="calculator" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">SME Reconciliation</h1>
                    <p class="text-gray-600">Automated reconciliation for GSTR2B and Tally transactions</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 space-y-8">
        <!-- Upload Section -->
        <section class="bg-white rounded-lg shadow-sm border p-6">
            <div class="flex items-center space-x-3 mb-6">
                <div class="p-2 bg-green-100 rounded-lg">
                    <i data-lucide="upload" class="w-5 h-5 text-green-600"></i>
                </div>
                <h2 class="text-2xl font-semibold text-gray-900">Upload Files</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- GSTR2B Upload -->
                <div class="space-y-3">
                    <label for="gstr2bFile" class="block text-sm font-medium text-gray-700">
                        GSTR2B File
                    </label>
                    <div class="relative">
                        <input 
                            type="file" 
                            id="gstr2bFile" 
                            accept=".xlsx,.xls,.csv"
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 border border-gray-300 rounded-lg cursor-pointer focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <i data-lucide="file-text" class="w-4 h-4 text-gray-400"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Supports CSV, XLS, XLSX formats</p>
                </div>

                <!-- Tally Upload -->
                <div class="space-y-3">
                    <label for="tallyFile" class="block text-sm font-medium text-gray-700">
                        Tally File
                    </label>
                    <div class="relative">
                        <input 
                            type="file" 
                            id="tallyFile" 
                            accept=".xlsx,.xls,.csv"
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 border border-gray-300 rounded-lg cursor-pointer focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        >
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <i data-lucide="file-text" class="w-4 h-4 text-gray-400"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Supports CSV, XLS, XLSX formats</p>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4">
                <button 
                    onclick="uploadFiles()" 
                    id="reconcileBtn"
                    class="flex items-center justify-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <i data-lucide="play" class="w-4 h-4"></i>
                    <span>Start Reconciliation</span>
                </button>
            </div>

            <!-- Status Messages -->
            <div id="status" class="mt-6"></div>
        </section>

        <!-- Metrics Dashboard -->
        <section class="bg-white rounded-lg shadow-sm border p-6" id="metricsSection" style="display: none;">
            <div class="flex items-center space-x-3 mb-6">
                <div class="p-2 bg-orange-100 rounded-lg">
                    <i data-lucide="bar-chart-3" class="w-5 h-5 text-orange-600"></i>
                </div>
                <h2 class="text-2xl font-semibold text-gray-900">Reconciliation Summary</h2>
            </div>
            <div id="metricsPanel" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Metrics cards will be inserted here -->
            </div>
        </section>

        <!-- Reconciled Transactions -->
        <section class="bg-white rounded-lg shadow-sm border" id="reconciledSection" style="display: none;">
            <div class="p-6 border-b">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-green-100 rounded-lg">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-900">Reconciled Transactions</h2>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <select 
                            id="confidenceFilter"
                            class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                            <option value="all">All Matches</option>
                            <option value="high">High Confidence (â‰¥95%)</option>
                            <option value="medium">Medium Confidence (85-95%)</option>
                            <option value="low">Low Confidence (<85%)</option>
                        </select>
                        <button 
                            onclick="exportToExcel()"
                            class="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"
                        >
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Export Excel</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div id="reconciledTable" class="overflow-x-auto"></div>
            </div>
        </section>

        <!-- Unmatched Transactions -->
        <section class="bg-white rounded-lg shadow-sm border" id="unmatchedSection" style="display: none;">
            <div class="p-6 border-b">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-red-100 rounded-lg">
                            <i data-lucide="alert-circle" class="w-5 h-5 text-red-600"></i>
                        </div>
                        <h2 class="text-2xl font-semibold text-gray-900">Unmatched Transactions</h2>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button 
                            onclick="exportUnmatchedGSTR2B()"
                            class="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
                        >
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>GSTR2B</span>
                        </button>
                        <button 
                            onclick="exportUnmatchedTally()"
                            class="flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors"
                        >
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>Tally</span>
                        </button>
                        <button 
                            onclick="exportAllUnmatched()"
                            class="flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"
                        >
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span>All Unmatched</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div id="unmatchedTable" class="overflow-x-auto"></div>
            </div>
        </section>

        <!-- Duplicates Panel -->
        <section class="bg-white rounded-lg shadow-sm border" id="duplicatesPanel" style="display: none;">
            <div class="p-6 border-b">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-yellow-100 rounded-lg">
                        <i data-lucide="copy" class="w-5 h-5 text-yellow-600"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-900">Potential Duplicates</h2>
                </div>
            </div>
            <div class="p-6">
                <div id="duplicatesList">
                    <!-- Duplicates will be inserted here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
            <div class="flex items-center space-x-4">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <div>
                    <p class="text-lg font-medium text-gray-900">Processing files...</p>
                    <p class="text-sm text-gray-500" id="loadingMessage">Please wait while we reconcile your data</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
    
    <style>
        /* Modern table styles */
        .modern-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        .modern-table th {
            background-color: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .modern-table td {
            border-bottom: 1px solid #f1f5f9;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #374151;
        }
        
        .modern-table tbody tr:hover {
            background-color: #f8fafc;
        }
        
        .modern-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Confidence score badges */
        .confidence-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .confidence-high {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .confidence-medium {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .confidence-low {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Source type indicators */
        .source-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .source-gstr2b {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .source-tally {
            background-color: #e9d5ff;
            color: #7c3aed;
        }
        
        /* Field highlighting */
        .field-gstr2b {
            border-left: 3px solid #3b82f6;
            background-color: #eff6ff;
        }
        
        .field-tally {
            border-left: 3px solid #8b5cf6;
            background-color: #f5f3ff;
        }
        
        .field-match {
            border-left: 3px solid #10b981;
            background-color: #ecfdf5;
        }
        
        .field-difference {
            border-left: 3px solid #f59e0b;
            background-color: #fffbeb;
        }
        
        /* Amount highlighting */
        .amount-exact {
            color: #059669;
            font-weight: 600;
        }
        
        .amount-diff {
            color: #d97706;
        }
        
        /* Metric cards */
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .metric-card.success {
            background: linear-gradient(135deg, #667eea 0%, #10b981 100%);
        }
        
        .metric-card.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .metric-card.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .metric-card.info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        /* Custom scrollbar */
        .overflow-x-auto::-webkit-scrollbar {
            height: 6px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Status message styles */
        .status-success {
            background-color: #dcfce7;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .status-error {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .status-info {
            background-color: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #1e40af;
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
        }
    </style>
</body>
</html>
